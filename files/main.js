(()=>{var en=Object.create;var Re=Object.defineProperty;var rn=Object.getOwnPropertyDescriptor;var nn=Object.getOwnPropertyNames;var sn=Object.getPrototypeOf,an=Object.prototype.hasOwnProperty;var S=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var ln=(t,n,s,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let m of nn(n))!an.call(t,m)&&m!==s&&Re(t,m,{get:()=>n[m],enumerable:!(l=rn(n,m))||l.enumerable});return t};var V=(t,n,s)=>(s=t!=null?en(sn(t)):{},ln(n||!t||!t.__esModule?Re(s,"default",{value:t,enumerable:!0}):s,t));var mt=S((fi,Se)=>{"use strict";function bt(t,n,s,l,m,c){return{tag:t,key:n,attrs:s,children:l,text:m,dom:c,domSize:void 0,state:void 0,events:void 0,instance:void 0}}bt.normalize=function(t){return Array.isArray(t)?bt("[",void 0,void 0,bt.normalizeChildren(t),void 0,void 0):t==null||typeof t=="boolean"?null:typeof t=="object"?t:bt("#",void 0,void 0,String(t),void 0,void 0)};bt.normalizeChildren=function(t){var n=[];if(t.length){for(var s=t[0]!=null&&t[0].key!=null,l=1;l<t.length;l++)if((t[l]!=null&&t[l].key!=null)!==s)throw new TypeError(s&&(t[l]!=null||typeof t[l]=="boolean")?"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.":"In fragments, vnodes must either all have keys or none have keys.");for(var l=0;l<t.length;l++)n[l]=bt.normalize(t[l])}return n};Se.exports=bt});var ce=S((mi,De)=>{"use strict";var un=mt();De.exports=function(){var t=arguments[this],n=this+1,s;if(t==null?t={}:(typeof t!="object"||t.tag!=null||Array.isArray(t))&&(t={},n=this),arguments.length===n+1)s=arguments[n],Array.isArray(s)||(s=[s]);else for(s=[];n<arguments.length;)s.push(arguments[n++]);return un("",t.key,t,s)}});var Ot=S((pi,ze)=>{"use strict";ze.exports={}.hasOwnProperty});var oe=S((hi,Be)=>{"use strict";var cn=mt(),on=ce(),It=Ot(),fn=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,_e={};function Me(t){for(var n in t)if(It.call(t,n))return!1;return!0}function mn(t){for(var n,s="div",l=[],m={};n=fn.exec(t);){var c=n[1],o=n[2];if(c===""&&o!=="")s=o;else if(c==="#")m.id=o;else if(c===".")l.push(o);else if(n[3][0]==="["){var h=n[6];h&&(h=h.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),n[4]==="class"?l.push(h):m[n[4]]=h===""?h:h||!0}}return l.length>0&&(m.className=l.join(" ")),_e[t]={tag:s,attrs:m}}function pn(t,n){var s=n.attrs,l=It.call(s,"class"),m=l?s.class:s.className;if(n.tag=t.tag,n.attrs={},!Me(t.attrs)&&!Me(s)){var c={};for(var o in s)It.call(s,o)&&(c[o]=s[o]);s=c}for(var o in t.attrs)It.call(t.attrs,o)&&o!=="className"&&!It.call(s,o)&&(s[o]=t.attrs[o]);(m!=null||t.attrs.className!=null)&&(s.className=m!=null?t.attrs.className!=null?String(t.attrs.className)+" "+String(m):m:t.attrs.className!=null?t.attrs.className:null),l&&(s.class=null);for(var o in s)if(It.call(s,o)&&o!=="key"){n.attrs=s;break}return n}function hn(t){if(t==null||typeof t!="string"&&typeof t!="function"&&typeof t.view!="function")throw Error("The selector must be either a string or a component.");var n=on.apply(1,arguments);return typeof t=="string"&&(n.children=cn.normalizeChildren(n.children),t!=="[")?pn(_e[t]||mn(t),n):(n.tag=t,n)}Be.exports=hn});var Fe=S((di,$e)=>{"use strict";var dn=mt();$e.exports=function(t){return t==null&&(t=""),dn("<",void 0,void 0,t,void 0,void 0)}});var He=S((gi,Ue)=>{"use strict";var gn=mt(),yn=ce();Ue.exports=function(){var t=yn.apply(0,arguments);return t.tag="[",t.children=gn.normalizeChildren(t.children),t}});var Je=S((yi,Ge)=>{"use strict";var fe=oe();fe.trust=Fe();fe.fragment=He();Ge.exports=fe});var me=S((bi,Ke)=>{"use strict";var G=function(t){if(!(this instanceof G))throw new Error("Promise must be called with 'new'.");if(typeof t!="function")throw new TypeError("executor must be a function.");var n=this,s=[],l=[],m=f(s,!0),c=f(l,!1),o=n._instance={resolvers:s,rejectors:l},h=typeof setImmediate=="function"?setImmediate:setTimeout;function f(x,b){return function T(I){var E;try{if(b&&I!=null&&(typeof I=="object"||typeof I=="function")&&typeof(E=I.then)=="function"){if(I===n)throw new TypeError("Promise can't be resolved with itself.");d(E.bind(I))}else h(function(){!b&&x.length===0&&console.error("Possible unhandled promise rejection:",I);for(var w=0;w<x.length;w++)x[w](I);s.length=0,l.length=0,o.state=b,o.retry=function(){T(I)}})}catch(w){c(w)}}}function d(x){var b=0;function T(E){return function(w){b++>0||E(w)}}var I=T(c);try{x(T(m),I)}catch(E){I(E)}}d(t)};G.prototype.then=function(t,n){var s=this,l=s._instance;function m(f,d,x,b){d.push(function(T){if(typeof f!="function")x(T);else try{c(f(T))}catch(I){o&&o(I)}}),typeof l.retry=="function"&&b===l.state&&l.retry()}var c,o,h=new G(function(f,d){c=f,o=d});return m(t,l.resolvers,c,!0),m(n,l.rejectors,o,!1),h};G.prototype.catch=function(t){return this.then(null,t)};G.prototype.finally=function(t){return this.then(function(n){return G.resolve(t()).then(function(){return n})},function(n){return G.resolve(t()).then(function(){return G.reject(n)})})};G.resolve=function(t){return t instanceof G?t:new G(function(n){n(t)})};G.reject=function(t){return new G(function(n,s){s(t)})};G.all=function(t){return new G(function(n,s){var l=t.length,m=0,c=[];if(t.length===0)n([]);else for(var o=0;o<t.length;o++)(function(h){function f(d){m++,c[h]=d,m===l&&n(c)}t[h]!=null&&(typeof t[h]=="object"||typeof t[h]=="function")&&typeof t[h].then=="function"?t[h].then(f,s):f(t[h])})(o)})};G.race=function(t){return new G(function(n,s){for(var l=0;l<t.length;l++)t[l].then(n,s)})};Ke.exports=G});var pe=S((wi,Ht)=>{"use strict";var Rt=me();typeof window<"u"?(typeof window.Promise>"u"?window.Promise=Rt:window.Promise.prototype.finally||(window.Promise.prototype.finally=Rt.prototype.finally),Ht.exports=window.Promise):typeof global<"u"?(typeof global.Promise>"u"?global.Promise=Rt:global.Promise.prototype.finally||(global.Promise.prototype.finally=Rt.prototype.finally),Ht.exports=global.Promise):Ht.exports=Rt});var Ve=S((xi,Qe)=>{"use strict";var he=mt();Qe.exports=function(t){var n=t&&t.document,s,l={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function m(r){return r.attrs&&r.attrs.xmlns||l[r.tag]}function c(r,e){if(r.state!==e)throw new Error("'vnode.state' must not be modified.")}function o(r){var e=r.state;try{return this.apply(e,arguments)}finally{c(r,e)}}function h(){try{return n.activeElement}catch{return null}}function f(r,e,i,a,u,p,y){for(var C=i;C<a;C++){var g=e[C];g!=null&&d(r,g,u,y,p)}}function d(r,e,i,a,u){var p=e.tag;if(typeof p=="string")switch(e.state={},e.attrs!=null&&ee(e.attrs,e,i),p){case"#":x(r,e,u);break;case"<":T(r,e,a,u);break;case"[":I(r,e,i,a,u);break;default:E(r,e,i,a,u)}else R(r,e,i,a,u)}function x(r,e,i){e.dom=n.createTextNode(e.children),lt(r,e.dom,i)}var b={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function T(r,e,i,a){var u=e.children.match(/^\s*?<(\w+)/im)||[],p=n.createElement(b[u[1]]||"div");i==="http://www.w3.org/2000/svg"?(p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+e.children+"</svg>",p=p.firstChild):p.innerHTML=e.children,e.dom=p.firstChild,e.domSize=p.childNodes.length,e.instance=[];for(var y=n.createDocumentFragment(),C;C=p.firstChild;)e.instance.push(C),y.appendChild(C);lt(r,y,a)}function I(r,e,i,a,u){var p=n.createDocumentFragment();if(e.children!=null){var y=e.children;f(p,y,0,y.length,i,null,a)}e.dom=p.firstChild,e.domSize=p.childNodes.length,lt(r,p,u)}function E(r,e,i,a,u){var p=e.tag,y=e.attrs,C=y&&y.is;a=m(e)||a;var g=a?C?n.createElementNS(a,p,{is:C}):n.createElementNS(a,p):C?n.createElement(p,{is:C}):n.createElement(p);if(e.dom=g,y!=null&&Jr(e,y,a),lt(r,g,u),!Ee(e)&&e.children!=null){var N=e.children;f(g,N,0,N.length,i,null,a),e.tag==="select"&&y!=null&&Qr(e,y)}}function w(r,e){var i;if(typeof r.tag.view=="function"){if(r.state=Object.create(r.tag),i=r.state.view,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0}else{if(r.state=void 0,i=r.tag,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0,r.state=r.tag.prototype!=null&&typeof r.tag.prototype.view=="function"?new r.tag(r):r.tag(r)}if(ee(r.state,r,e),r.attrs!=null&&ee(r.attrs,r,e),r.instance=he.normalize(o.call(r.state.view,r)),r.instance===r)throw Error("A view cannot return the vnode it received as argument");i.$$reentrantLock$$=null}function R(r,e,i,a,u){w(e,i),e.instance!=null?(d(r,e.instance,i,a,u),e.dom=e.instance.dom,e.domSize=e.dom!=null?e.instance.domSize:0):e.domSize=0}function F(r,e,i,a,u,p){if(!(e===i||e==null&&i==null))if(e==null||e.length===0)f(r,i,0,i.length,a,u,p);else if(i==null||i.length===0)Nt(r,e,0,e.length);else{var y=e[0]!=null&&e[0].key!=null,C=i[0]!=null&&i[0].key!=null,g=0,N=0;if(!y)for(;N<e.length&&e[N]==null;)N++;if(!C)for(;g<i.length&&i[g]==null;)g++;if(y!==C)Nt(r,e,N,e.length),f(r,i,g,i.length,a,u,p);else if(C){for(var tt=e.length-1,H=i.length-1,Ut,et,B,Z,D,ie;tt>=N&&H>=g&&(Z=e[tt],D=i[H],Z.key===D.key);)Z!==D&&rt(r,Z,D,a,u,p),D.dom!=null&&(u=D.dom),tt--,H--;for(;tt>=N&&H>=g&&(et=e[N],B=i[g],et.key===B.key);)N++,g++,et!==B&&rt(r,et,B,a,it(e,N,u),p);for(;tt>=N&&H>=g&&!(g===H||et.key!==D.key||Z.key!==B.key);)ie=it(e,N,u),xt(r,Z,ie),Z!==B&&rt(r,Z,B,a,ie,p),++g<=--H&&xt(r,et,u),et!==D&&rt(r,et,D,a,u,p),D.dom!=null&&(u=D.dom),N++,tt--,Z=e[tt],D=i[H],et=e[N],B=i[g];for(;tt>=N&&H>=g&&Z.key===D.key;)Z!==D&&rt(r,Z,D,a,u,p),D.dom!=null&&(u=D.dom),tt--,H--,Z=e[tt],D=i[H];if(g>H)Nt(r,e,N,tt+1);else if(N>tt)f(r,i,g,H+1,a,u,p);else{var tn=u,Oe=H-g+1,Pt=new Array(Oe),se=0,M=0,ae=2147483647,le=0,Ut,ue;for(M=0;M<Oe;M++)Pt[M]=-1;for(M=H;M>=g;M--){Ut==null&&(Ut=v(e,N,tt+1)),D=i[M];var Tt=Ut[D.key];Tt!=null&&(ae=Tt<ae?Tt:-1,Pt[M-g]=Tt,Z=e[Tt],e[Tt]=null,Z!==D&&rt(r,Z,D,a,u,p),D.dom!=null&&(u=D.dom),le++)}if(u=tn,le!==tt-N+1&&Nt(r,e,N,tt+1),le===0)f(r,i,g,H+1,a,u,p);else if(ae===-1)for(ue=X(Pt),se=ue.length-1,M=H;M>=g;M--)B=i[M],Pt[M-g]===-1?d(r,B,a,p,u):ue[se]===M-g?se--:xt(r,B,u),B.dom!=null&&(u=i[M].dom);else for(M=H;M>=g;M--)B=i[M],Pt[M-g]===-1&&d(r,B,a,p,u),B.dom!=null&&(u=i[M].dom)}}else{var ne=e.length<i.length?e.length:i.length;for(g=g<N?g:N;g<ne;g++)et=e[g],B=i[g],!(et===B||et==null&&B==null)&&(et==null?d(r,B,a,p,it(e,g+1,u)):B==null?$t(r,et):rt(r,et,B,a,it(e,g+1,u),p));e.length>ne&&Nt(r,e,g,e.length),i.length>ne&&f(r,i,g,i.length,a,u,p)}}}function rt(r,e,i,a,u,p){var y=e.tag,C=i.tag;if(y===C){if(i.state=e.state,i.events=e.events,Zr(i,e))return;if(typeof y=="string")switch(i.attrs!=null&&re(i.attrs,i,a),y){case"#":_(e,i);break;case"<":k(r,e,i,p,u);break;case"[":O(r,e,i,a,u,p);break;default:j(e,i,a,p)}else z(r,e,i,a,u,p)}else $t(r,e),d(r,i,a,p,u)}function _(r,e){r.children.toString()!==e.children.toString()&&(r.dom.nodeValue=e.children),e.dom=r.dom}function k(r,e,i,a,u){e.children!==i.children?(ve(r,e),T(r,i,a,u)):(i.dom=e.dom,i.domSize=e.domSize,i.instance=e.instance)}function O(r,e,i,a,u,p){F(r,e.children,i.children,a,u,p);var y=0,C=i.children;if(i.dom=null,C!=null){for(var g=0;g<C.length;g++){var N=C[g];N!=null&&N.dom!=null&&(i.dom==null&&(i.dom=N.dom),y+=N.domSize||1)}y!==1&&(i.domSize=y)}}function j(r,e,i,a){var u=e.dom=r.dom;a=m(e)||a,e.tag==="textarea"&&e.attrs==null&&(e.attrs={}),Vr(e,r.attrs,e.attrs,a),Ee(e)||F(u,r.children,e.children,i,null,a)}function z(r,e,i,a,u,p){if(i.instance=he.normalize(o.call(i.state.view,i)),i.instance===i)throw Error("A view cannot return the vnode it received as argument");re(i.state,i,a),i.attrs!=null&&re(i.attrs,i,a),i.instance!=null?(e.instance==null?d(r,i.instance,a,p,u):rt(r,e.instance,i.instance,a,u,p),i.dom=i.instance.dom,i.domSize=i.instance.domSize):e.instance!=null?($t(r,e.instance),i.dom=void 0,i.domSize=0):(i.dom=e.dom,i.domSize=e.domSize)}function v(r,e,i){for(var a=Object.create(null);e<i;e++){var u=r[e];if(u!=null){var p=u.key;p!=null&&(a[p]=e)}}return a}var L=[];function X(r){for(var e=[0],i=0,a=0,u=0,p=L.length=r.length,u=0;u<p;u++)L[u]=r[u];for(var u=0;u<p;++u)if(r[u]!==-1){var y=e[e.length-1];if(r[y]<r[u]){L[u]=y,e.push(u);continue}for(i=0,a=e.length-1;i<a;){var C=(i>>>1)+(a>>>1)+(i&a&1);r[e[C]]<r[u]?i=C+1:a=C}r[u]<r[e[i]]&&(i>0&&(L[u]=e[i-1]),e[i]=u)}for(i=e.length,a=e[i-1];i-- >0;)e[i]=a,a=L[a];return L.length=0,e}function it(r,e,i){for(;e<r.length;e++)if(r[e]!=null&&r[e].dom!=null)return r[e].dom;return i}function xt(r,e,i){var a=n.createDocumentFragment();yt(r,a,e),lt(r,a,i)}function yt(r,e,i){for(;i.dom!=null&&i.dom.parentNode===r;){if(typeof i.tag!="string"){if(i=i.instance,i!=null)continue}else if(i.tag==="<")for(var a=0;a<i.instance.length;a++)e.appendChild(i.instance[a]);else if(i.tag!=="[")e.appendChild(i.dom);else if(i.children.length===1){if(i=i.children[0],i!=null)continue}else for(var a=0;a<i.children.length;a++){var u=i.children[a];u!=null&&yt(r,e,u)}break}}function lt(r,e,i){i!=null?r.insertBefore(e,i):r.appendChild(e)}function Ee(r){if(r.attrs==null||r.attrs.contenteditable==null&&r.attrs.contentEditable==null)return!1;var e=r.children;if(e!=null&&e.length===1&&e[0].tag==="<"){var i=e[0].children;r.dom.innerHTML!==i&&(r.dom.innerHTML=i)}else if(e!=null&&e.length!==0)throw new Error("Child node of a contenteditable must be trusted.");return!0}function Nt(r,e,i,a){for(var u=i;u<a;u++){var p=e[u];p!=null&&$t(r,p)}}function $t(r,e){var i=0,a=e.state,u,p;if(typeof e.tag!="string"&&typeof e.state.onbeforeremove=="function"){var y=o.call(e.state.onbeforeremove,e);y!=null&&typeof y.then=="function"&&(i=1,u=y)}if(e.attrs&&typeof e.attrs.onbeforeremove=="function"){var y=o.call(e.attrs.onbeforeremove,e);y!=null&&typeof y.then=="function"&&(i|=2,p=y)}if(c(e,a),!i)Ft(e),Wt(r,e);else{if(u!=null){var C=function(){i&1&&(i&=2,i||g())};u.then(C,C)}if(p!=null){var C=function(){i&2&&(i&=1,i||g())};p.then(C,C)}}function g(){c(e,a),Ft(e),Wt(r,e)}}function ve(r,e){for(var i=0;i<e.instance.length;i++)r.removeChild(e.instance[i])}function Wt(r,e){for(;e.dom!=null&&e.dom.parentNode===r;){if(typeof e.tag!="string"){if(e=e.instance,e!=null)continue}else if(e.tag==="<")ve(r,e);else{if(e.tag!=="["&&(r.removeChild(e.dom),!Array.isArray(e.children)))break;if(e.children.length===1){if(e=e.children[0],e!=null)continue}else for(var i=0;i<e.children.length;i++){var a=e.children[i];a!=null&&Wt(r,a)}}break}}function Ft(r){if(typeof r.tag!="string"&&typeof r.state.onremove=="function"&&o.call(r.state.onremove,r),r.attrs&&typeof r.attrs.onremove=="function"&&o.call(r.attrs.onremove,r),typeof r.tag!="string")r.instance!=null&&Ft(r.instance);else{var e=r.children;if(Array.isArray(e))for(var i=0;i<e.length;i++){var a=e[i];a!=null&&Ft(a)}}}function Jr(r,e,i){r.tag==="input"&&e.type!=null&&r.dom.setAttribute("type",e.type);var a=e!=null&&r.tag==="input"&&e.type==="file";for(var u in e)Xt(r,u,null,e[u],i,a)}function Xt(r,e,i,a,u,p){if(!(e==="key"||e==="is"||a==null||qe(e)||i===a&&!Yr(r,e)&&typeof a!="object"||e==="type"&&r.tag==="input")){if(e[0]==="o"&&e[1]==="n")return Pe(r,e,a);if(e.slice(0,6)==="xlink:")r.dom.setAttributeNS("http://www.w3.org/1999/xlink",e.slice(6),a);else if(e==="style")Ae(r.dom,i,a);else if(Ne(r,e,u)){if(e==="value"){if((r.tag==="input"||r.tag==="textarea")&&r.dom.value===""+a&&(p||r.dom===h())||r.tag==="select"&&i!==null&&r.dom.value===""+a||r.tag==="option"&&i!==null&&r.dom.value===""+a)return;if(p&&""+a!=""){console.error("`value` is read-only on file inputs!");return}}r.dom[e]=a}else typeof a=="boolean"?a?r.dom.setAttribute(e,""):r.dom.removeAttribute(e):r.dom.setAttribute(e==="className"?"class":e,a)}}function Kr(r,e,i,a){if(!(e==="key"||e==="is"||i==null||qe(e)))if(e[0]==="o"&&e[1]==="n")Pe(r,e,void 0);else if(e==="style")Ae(r.dom,i,null);else if(Ne(r,e,a)&&e!=="className"&&e!=="title"&&!(e==="value"&&(r.tag==="option"||r.tag==="select"&&r.dom.selectedIndex===-1&&r.dom===h()))&&!(r.tag==="input"&&e==="type"))r.dom[e]=null;else{var u=e.indexOf(":");u!==-1&&(e=e.slice(u+1)),i!==!1&&r.dom.removeAttribute(e==="className"?"class":e)}}function Qr(r,e){if("value"in e)if(e.value===null)r.dom.selectedIndex!==-1&&(r.dom.value=null);else{var i=""+e.value;(r.dom.value!==i||r.dom.selectedIndex===-1)&&(r.dom.value=i)}"selectedIndex"in e&&Xt(r,"selectedIndex",null,e.selectedIndex,void 0)}function Vr(r,e,i,a){if(e&&e===i&&console.warn("Don't reuse attrs object, use new object for every redraw, this will throw in next major"),i!=null){r.tag==="input"&&i.type!=null&&r.dom.setAttribute("type",i.type);var u=r.tag==="input"&&i.type==="file";for(var p in i)Xt(r,p,e&&e[p],i[p],a,u)}var y;if(e!=null)for(var p in e)(y=e[p])!=null&&(i==null||i[p]==null)&&Kr(r,p,y,a)}function Yr(r,e){return e==="value"||e==="checked"||e==="selectedIndex"||e==="selected"&&r.dom===h()||r.tag==="option"&&r.dom.parentNode===n.activeElement}function qe(r){return r==="oninit"||r==="oncreate"||r==="onupdate"||r==="onremove"||r==="onbeforeremove"||r==="onbeforeupdate"}function Ne(r,e,i){return i===void 0&&(r.tag.indexOf("-")>-1||r.attrs!=null&&r.attrs.is||e!=="href"&&e!=="list"&&e!=="form"&&e!=="width"&&e!=="height")&&e in r.dom}var Wr=/[A-Z]/g;function Xr(r){return"-"+r.toLowerCase()}function Zt(r){return r[0]==="-"&&r[1]==="-"?r:r==="cssFloat"?"float":r.replace(Wr,Xr)}function Ae(r,e,i){if(e!==i)if(i==null)r.style.cssText="";else if(typeof i!="object")r.style.cssText=i;else if(e==null||typeof e!="object"){r.style.cssText="";for(var a in i){var u=i[a];u!=null&&r.style.setProperty(Zt(a),String(u))}}else{for(var a in i){var u=i[a];u!=null&&(u=String(u))!==String(e[a])&&r.style.setProperty(Zt(a),u)}for(var a in e)e[a]!=null&&i[a]==null&&r.style.removeProperty(Zt(a))}}function te(){this._=s}te.prototype=Object.create(null),te.prototype.handleEvent=function(r){var e=this["on"+r.type],i;typeof e=="function"?i=e.call(r.currentTarget,r):typeof e.handleEvent=="function"&&e.handleEvent(r),this._&&r.redraw!==!1&&(0,this._)(),i===!1&&(r.preventDefault(),r.stopPropagation())};function Pe(r,e,i){if(r.events!=null){if(r.events._=s,r.events[e]===i)return;i!=null&&(typeof i=="function"||typeof i=="object")?(r.events[e]==null&&r.dom.addEventListener(e.slice(2),r.events,!1),r.events[e]=i):(r.events[e]!=null&&r.dom.removeEventListener(e.slice(2),r.events,!1),r.events[e]=void 0)}else i!=null&&(typeof i=="function"||typeof i=="object")&&(r.events=new te,r.dom.addEventListener(e.slice(2),r.events,!1),r.events[e]=i)}function ee(r,e,i){typeof r.oninit=="function"&&o.call(r.oninit,e),typeof r.oncreate=="function"&&i.push(o.bind(r.oncreate,e))}function re(r,e,i){typeof r.onupdate=="function"&&i.push(o.bind(r.onupdate,e))}function Zr(r,e){do{if(r.attrs!=null&&typeof r.attrs.onbeforeupdate=="function"){var i=o.call(r.attrs.onbeforeupdate,r,e);if(i!==void 0&&!i)break}if(typeof r.tag!="string"&&typeof r.state.onbeforeupdate=="function"){var i=o.call(r.state.onbeforeupdate,r,e);if(i!==void 0&&!i)break}return!1}while(!1);return r.dom=e.dom,r.domSize=e.domSize,r.instance=e.instance,r.attrs=e.attrs,r.children=e.children,r.text=e.text,!0}var At;return function(r,e,i){if(!r)throw new TypeError("DOM element being rendered to does not exist.");if(At!=null&&r.contains(At))throw new TypeError("Node is currently being rendered to and thus is locked.");var a=s,u=At,p=[],y=h(),C=r.namespaceURI;At=r,s=typeof i=="function"?i:void 0;try{r.vnodes==null&&(r.textContent=""),e=he.normalizeChildren(Array.isArray(e)?e:[e]),F(r,r.vnodes,e,p,null,C==="http://www.w3.org/1999/xhtml"?void 0:C),r.vnodes=e,y!=null&&h()!==y&&typeof y.focus=="function"&&y.focus();for(var g=0;g<p.length;g++)p[g]()}finally{s=a,At=u}}}});var de=S((Ti,Ye)=>{"use strict";Ye.exports=Ve()(typeof window<"u"?window:null)});var Ze=S((Ii,Xe)=>{"use strict";var We=mt();Xe.exports=function(t,n,s){var l=[],m=!1,c=-1;function o(){for(c=0;c<l.length;c+=2)try{t(l[c],We(l[c+1]),h)}catch(d){s.error(d)}c=-1}function h(){m||(m=!0,n(function(){m=!1,o()}))}h.sync=o;function f(d,x){if(x!=null&&x.view==null&&typeof x!="function")throw new TypeError("m.mount expects a component, not a vnode.");var b=l.indexOf(d);b>=0&&(l.splice(b,2),b<=c&&(c-=2),t(d,[])),x!=null&&(l.push(d,x),t(d,We(x),h))}return{mount:f,redraw:h}}});var Gt=S((ji,tr)=>{"use strict";var bn=de();tr.exports=Ze()(bn,typeof requestAnimationFrame<"u"?requestAnimationFrame:null,typeof console<"u"?console:null)});var ge=S((ki,er)=>{"use strict";er.exports=function(t){if(Object.prototype.toString.call(t)!=="[object Object]")return"";var n=[];for(var s in t)l(s,t[s]);return n.join("&");function l(m,c){if(Array.isArray(c))for(var o=0;o<c.length;o++)l(m+"["+o+"]",c[o]);else if(Object.prototype.toString.call(c)==="[object Object]")for(var o in c)l(m+"["+o+"]",c[o]);else n.push(encodeURIComponent(m)+(c!=null&&c!==""?"="+encodeURIComponent(c):""))}}});var ye=S((Li,rr)=>{"use strict";var wn=Ot();rr.exports=Object.assign||function(t,n){for(var s in n)wn.call(n,s)&&(t[s]=n[s])}});var Jt=S((Ci,nr)=>{"use strict";var xn=ge(),Tn=ye();nr.exports=function(t,n){if(/:([^\/\.-]+)(\.{3})?:/.test(t))throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.");if(n==null)return t;var s=t.indexOf("?"),l=t.indexOf("#"),m=l<0?t.length:l,c=s<0?m:s,o=t.slice(0,c),h={};Tn(h,n);var f=o.replace(/:([^\/\.-]+)(\.{3})?/g,function(w,R,F){return delete h[R],n[R]==null?w:F?n[R]:encodeURIComponent(String(n[R]))}),d=f.indexOf("?"),x=f.indexOf("#"),b=x<0?f.length:x,T=d<0?b:d,I=f.slice(0,T);s>=0&&(I+=t.slice(s,m)),d>=0&&(I+=(s<0?"?":"&")+f.slice(d,b));var E=xn(h);return E&&(I+=(s<0&&d<0?"?":"&")+E),l>=0&&(I+=t.slice(l)),x>=0&&(I+=(l<0?"":"&")+f.slice(x)),I}});var ar=S((Ei,sr)=>{"use strict";var In=Jt(),ir=Ot();sr.exports=function(t,n,s){var l=0;function m(h){return new n(h)}m.prototype=n.prototype,m.__proto__=n;function c(h){return function(f,d){typeof f!="string"?(d=f,f=f.url):d==null&&(d={});var x=new n(function(E,w){h(In(f,d.params),d,function(R){if(typeof d.type=="function")if(Array.isArray(R))for(var F=0;F<R.length;F++)R[F]=new d.type(R[F]);else R=new d.type(R);E(R)},w)});if(d.background===!0)return x;var b=0;function T(){--b===0&&typeof s=="function"&&s()}return I(x);function I(E){var w=E.then;return E.constructor=m,E.then=function(){b++;var R=w.apply(E,arguments);return R.then(T,function(F){if(T(),b===0)throw F}),I(R)},E}}}function o(h,f){for(var d in h.headers)if(ir.call(h.headers,d)&&d.toLowerCase()===f)return!0;return!1}return{request:c(function(h,f,d,x){var b=f.method!=null?f.method.toUpperCase():"GET",T=f.body,I=(f.serialize==null||f.serialize===JSON.serialize)&&!(T instanceof t.FormData||T instanceof t.URLSearchParams),E=f.responseType||(typeof f.extract=="function"?"":"json"),w=new t.XMLHttpRequest,R=!1,F=!1,rt=w,_,k=w.abort;w.abort=function(){R=!0,k.call(this)},w.open(b,h,f.async!==!1,typeof f.user=="string"?f.user:void 0,typeof f.password=="string"?f.password:void 0),I&&T!=null&&!o(f,"content-type")&&w.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof f.deserialize!="function"&&!o(f,"accept")&&w.setRequestHeader("Accept","application/json, text/*"),f.withCredentials&&(w.withCredentials=f.withCredentials),f.timeout&&(w.timeout=f.timeout),w.responseType=E;for(var O in f.headers)ir.call(f.headers,O)&&w.setRequestHeader(O,f.headers[O]);w.onreadystatechange=function(j){if(!R&&j.target.readyState===4)try{var z=j.target.status>=200&&j.target.status<300||j.target.status===304||/^file:\/\//i.test(h),v=j.target.response,L;if(E==="json"){if(!j.target.responseType&&typeof f.extract!="function")try{v=JSON.parse(j.target.responseText)}catch{v=null}}else(!E||E==="text")&&v==null&&(v=j.target.responseText);if(typeof f.extract=="function"?(v=f.extract(j.target,f),z=!0):typeof f.deserialize=="function"&&(v=f.deserialize(v)),z)d(v);else{var X=function(){try{L=j.target.responseText}catch{L=v}var it=new Error(L);it.code=j.target.status,it.response=v,x(it)};w.status===0?setTimeout(function(){F||X()}):X()}}catch(it){x(it)}},w.ontimeout=function(j){F=!0;var z=new Error("Request timed out");z.code=j.target.status,x(z)},typeof f.config=="function"&&(w=f.config(w,f,h)||w,w!==rt&&(_=w.abort,w.abort=function(){R=!0,_.call(this)})),T==null?w.send():typeof f.serialize=="function"?w.send(f.serialize(T)):T instanceof t.FormData||T instanceof t.URLSearchParams?w.send(T):w.send(JSON.stringify(T))}),jsonp:c(function(h,f,d,x){var b=f.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+l++,T=t.document.createElement("script");t[b]=function(I){delete t[b],T.parentNode.removeChild(T),d(I)},T.onerror=function(){delete t[b],T.parentNode.removeChild(T),x(new Error("JSONP request failed"))},T.src=h+(h.indexOf("?")<0?"?":"&")+encodeURIComponent(f.callbackKey||"callback")+"="+encodeURIComponent(b),t.document.documentElement.appendChild(T)})}}});var ur=S((vi,lr)=>{"use strict";var jn=pe(),kn=Gt();lr.exports=ar()(typeof window<"u"?window:null,jn,kn.redraw)});var be=S((qi,or)=>{"use strict";function cr(t){try{return decodeURIComponent(t)}catch{return t}}or.exports=function(t){if(t===""||t==null)return{};t.charAt(0)==="?"&&(t=t.slice(1));for(var n=t.split("&"),s={},l={},m=0;m<n.length;m++){var c=n[m].split("="),o=cr(c[0]),h=c.length===2?cr(c[1]):"";h==="true"?h=!0:h==="false"&&(h=!1);var f=o.split(/\]\[?|\[/),d=l;o.indexOf("[")>-1&&f.pop();for(var x=0;x<f.length;x++){var b=f[x],T=f[x+1],I=T==""||!isNaN(parseInt(T,10));if(b===""){var o=f.slice(0,x).join();s[o]==null&&(s[o]=Array.isArray(d)?d.length:0),b=s[o]++}else if(b==="__proto__")break;if(x===f.length-1)d[b]=h;else{var E=Object.getOwnPropertyDescriptor(d,b);E!=null&&(E=E.value),E==null&&(d[b]=E=I?[]:{}),d=E}}}return l}});var Kt=S((Ni,fr)=>{"use strict";var Ln=be();fr.exports=function(t){var n=t.indexOf("?"),s=t.indexOf("#"),l=s<0?t.length:s,m=n<0?l:n,c=t.slice(0,m).replace(/\/{2,}/g,"/");return c?(c[0]!=="/"&&(c="/"+c),c.length>1&&c[c.length-1]==="/"&&(c=c.slice(0,-1))):c="/",{path:c,params:n<0?{}:Ln(t.slice(n+1,l))}}});var pr=S((Ai,mr)=>{"use strict";var Cn=Kt();mr.exports=function(t){var n=Cn(t),s=Object.keys(n.params),l=[],m=new RegExp("^"+n.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(c,o,h){return o==null?"\\"+c:(l.push({k:o,r:h==="..."}),h==="..."?"(.*)":h==="."?"([^/]+)\\.":"([^/]+)"+(h||""))})+"$");return function(c){for(var o=0;o<s.length;o++)if(n.params[s[o]]!==c.params[s[o]])return!1;if(!l.length)return m.test(c.path);var h=m.exec(c.path);if(h==null)return!1;for(var o=0;o<l.length;o++)c.params[l[o].k]=l[o].r?h[o+1]:decodeURIComponent(h[o+1]);return!0}}});var we=S((Pi,gr)=>{"use strict";var hr=Ot(),dr=new RegExp("^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$");gr.exports=function(t,n){var s={};if(n!=null)for(var l in t)hr.call(t,l)&&!dr.test(l)&&n.indexOf(l)<0&&(s[l]=t[l]);else for(var l in t)hr.call(t,l)&&!dr.test(l)&&(s[l]=t[l]);return s}});var xr=S((Oi,wr)=>{"use strict";var En=mt(),vn=oe(),qn=pe(),yr=Jt(),br=Kt(),Nn=pr(),An=ye(),Pn=we(),xe={};function On(t){try{return decodeURIComponent(t)}catch{return t}}wr.exports=function(t,n){var s=t==null?null:typeof t.setImmediate=="function"?t.setImmediate:t.setTimeout,l=qn.resolve(),m=!1,c=!1,o=0,h,f,d=xe,x,b,T,I,E={onbeforeupdate:function(){return o=o?2:1,!(!o||xe===d)},onremove:function(){t.removeEventListener("popstate",F,!1),t.removeEventListener("hashchange",R,!1)},view:function(){if(!(!o||xe===d)){var k=[En(x,b.key,b)];return d&&(k=d.render(k[0])),k}}},w=_.SKIP={};function R(){m=!1;var k=t.location.hash;_.prefix[0]!=="#"&&(k=t.location.search+k,_.prefix[0]!=="?"&&(k=t.location.pathname+k,k[0]!=="/"&&(k="/"+k)));var O=k.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,On).slice(_.prefix.length),j=br(O);An(j.params,t.history.state);function z(L){console.error(L),rt(f,null,{replace:!0})}v(0);function v(L){for(;L<h.length;L++)if(h[L].check(j)){var X=h[L].component,it=h[L].route,xt=X,yt=I=function(lt){if(yt===I){if(lt===w)return v(L+1);x=lt!=null&&(typeof lt.view=="function"||typeof lt=="function")?lt:"div",b=j.params,T=O,I=null,d=X.render?X:null,o===2?n.redraw():(o=2,n.redraw.sync())}};X.view||typeof X=="function"?(X={},yt(xt)):X.onmatch?l.then(function(){return X.onmatch(j.params,O,it)}).then(yt,O===f?null:z):yt("div");return}if(O===f)throw new Error("Could not resolve default route "+f+".");rt(f,null,{replace:!0})}}function F(){m||(m=!0,s(R))}function rt(k,O,j){if(k=yr(k,O),c){F();var z=j?j.state:null,v=j?j.title:null;j&&j.replace?t.history.replaceState(z,v,_.prefix+k):t.history.pushState(z,v,_.prefix+k)}else t.location.href=_.prefix+k}function _(k,O,j){if(!k)throw new TypeError("DOM element being rendered to does not exist.");if(h=Object.keys(j).map(function(v){if(v[0]!=="/")throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(v))throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.");return{route:v,component:j[v],check:Nn(v)}}),f=O,O!=null){var z=br(O);if(!h.some(function(v){return v.check(z)}))throw new ReferenceError("Default route doesn't match any known routes.")}typeof t.history.pushState=="function"?t.addEventListener("popstate",F,!1):_.prefix[0]==="#"&&t.addEventListener("hashchange",R,!1),c=!0,n.mount(k,E),R()}return _.set=function(k,O,j){I!=null&&(j=j||{},j.replace=!0),I=null,rt(k,O,j)},_.get=function(){return T},_.prefix="#!",_.Link={view:function(k){var O=vn(k.attrs.selector||"a",Pn(k.attrs,["options","params","selector","onclick"]),k.children),j,z,v;return(O.attrs.disabled=!!O.attrs.disabled)?(O.attrs.href=null,O.attrs["aria-disabled"]="true"):(j=k.attrs.options,z=k.attrs.onclick,v=yr(O.attrs.href,k.attrs.params),O.attrs.href=_.prefix+v,O.attrs.onclick=function(L){var X;typeof z=="function"?X=z.call(L.currentTarget,L):z==null||typeof z!="object"||typeof z.handleEvent=="function"&&z.handleEvent(L),X!==!1&&!L.defaultPrevented&&(L.button===0||L.which===0||L.which===1)&&(!L.currentTarget.target||L.currentTarget.target==="_self")&&!L.ctrlKey&&!L.metaKey&&!L.shiftKey&&!L.altKey&&(L.preventDefault(),L.redraw=!1,_.set(v,null,j))}),O}},_.param=function(k){return b&&k!=null?b[k]:b},_}});var Ir=S((Ri,Tr)=>{"use strict";var Rn=Gt();Tr.exports=xr()(typeof window<"u"?window:null,Rn)});var K=S((Si,Lr)=>{"use strict";var Qt=Je(),jr=ur(),kr=Gt(),J=function(){return Qt.apply(this,arguments)};J.m=Qt;J.trust=Qt.trust;J.fragment=Qt.fragment;J.Fragment="[";J.mount=kr.mount;J.route=Ir();J.render=de();J.redraw=kr.redraw;J.request=jr.request;J.jsonp=jr.jsonp;J.parseQueryString=be();J.buildQueryString=ge();J.parsePathname=Kt();J.buildPathname=Jt();J.vnode=mt();J.PromisePolyfill=me();J.censor=we();Lr.exports=J});var Gr=V(K());var Er=V(K());var Cr=V(K()),dt=new Map,Y={add(t,n){n===0?dt.set(t,0):(dt.set(t,n+(dt.get(t)??0)),setTimeout(()=>{let s=(dt.get(t)??0)-n;s<=0?(dt.delete(t),Cr.default.redraw()):dt.set(t,s)},n))},get(){return Array.from(dt.keys())},remove(t){dt.delete(t)}};var Sn=70,ut={id:0,name:"Tous les projets",accessLevel:10},jt=null,ct={get(){return ut},hasManagerRights(){return(ut.accessLevel??10)>=Sn},isLoading(){return jt!==null},load(t){return jt!==null?jt:ut.id===t?Promise.resolve(ut):t===0?(ut.id=0,ut.name="Tous les projets",Promise.resolve(ut)):(ut.id=t,ut.name="Chargement\u2026",jt=Er.default.request({method:"GET",url:"/plugin.php",params:{page:"TicketList/api",action:"project",id:t},withCredentials:!0}).then(function(n){ut=n}).catch(function(){Y.add(`Erreur en lisant l'api /project/${t}`,0)}).finally(function(){jt=null}),jt)},readJsonBlock(t){let n=document.getElementById(t);n!==null&&(ut=JSON.parse(n.textContent))}};var qt=V(K());var St=V(K());var Dn={view(t){return(0,St.default)("div.alert.alert-dismissible.alert-warning",{role:alert},(0,St.default)("button.close",{type:"button","data-dismiss":"alert","aria-label":"Close",onclick(){Y.remove(t.attrs.message)}},"\xD7"),t.attrs.message)}},vr={view(){return(0,St.default)("div#global-alerts",Y.get().map(t=>(0,St.default)(Dn,{message:t})))}};var P=V(K());var Vt=V(K());var kt={},pt={add(t,n,s){kt.serverList=t,kt.serverIds=n,kt.localIds=s},get(){return kt},isEmpty(){return!Object.hasOwn(kt,"serverList")},reset(){kt={}}};var Dt={id:0,ids:"",name:"",projectId:0,lastUpdate:""},$=Dt,ht={content:null},Lt=null;function zn(t){return Vt.default.request({method:"GET",url:"/plugin.php",params:{page:"TicketList/api",action:"list",id:t},withCredentials:!0}).then(function(n){return ht.content=n,n}).catch(function(){alert(`Erreur en lisant l'api /list/${t}`)}).finally(function(){Lt=null})}function Te(t){let n=t.split(/\n/),s=[];for(let l of n)if(l.match(/^\s*\d+/))for(let m of l.split(/[\s,]+/)){if(m.length<4||m.length>5)continue;let c=parseInt(m,10);c>0&&s.push(c)}return s}function qr(){let t=document.querySelector("#navbar-container .navbar-brand").textContent;document.title=$.name+" | "+t}var A={get(){return $},getTicketIds(){return Te($.ids)},setName(t){$.name=t},setText(t){$.ids=t},setProjectId(t){Dt.projectId=t,$.projectId=t},hasChanged(){return ht.content?$.ids.trim()!==ht.content.ids.trim():$.ids.trim()!==""},isLoading(){return Lt!==null},reset(){ht.content=null,$=Object.assign({},Dt),pt.reset()},delete(){return $.id===0?Promise.reject("La suppression d'une liste non-enregistr\xE9e est impossible."):(pt.reset(),Vt.default.request({method:"DELETE",url:"/plugin.php",params:{page:"TicketList/api",action:"list"},body:$,withCredentials:!0}).then(function(t){return t.status==="success"&&(ht.content=null,$=Object.assign({},Dt),Y.add("Liste supprim\xE9e du serveur)",3e3)),t}).catch(function(t){Y.add(`Erreur en \xE9crivant dans l'api DELETE /list:
${t}`,0)}))},load(t){return pt.reset(),typeof t!="number"||t<=0?Promise.resolve($):(Lt===null&&(Lt=zn(t)),Lt.then(function(n){return $=Object.assign({},n??Dt),$.ids.match(/^[\d,]+$/)&&($.ids=$.ids.replaceAll(",",`
`)+`
`),qr(),$}),Lt)},save(){return Vt.default.request({method:"PUT",url:"/plugin.php",params:{page:"TicketList/api",action:"list"},body:$,withCredentials:!0}).then(function(t){return t.status==="success"&&(ht.content=t.content,$=Object.assign({},t.content),qr(),Y.add("Liste enregistr\xE9e sur le serveur",3e3)),t.status==="need-confirm"&&(ht.content=t.content,pt.add(ht.content,Te(ht.content.ids),Te($.ids)),Y.add("Erreur, la liste du serveur a \xE9t\xE9 modifi\xE9e entre temps, ce qui cr\xE9e un conflit.",5e3)),t}).catch(function(t){Y.add(`Erreur en \xE9crivant dans l'api PUT /list:
${t}`,0)})}};var Nr=V(K());var Ie=[],Ct=null,wt={get(){return Ie},isLoading(){return Ct!==null},load(t){return Ct!==null||(Ct=Nr.default.request({method:"GET",url:"/plugin.php",params:{page:"TicketList/api",action:"list",projectId:t},withCredentials:!0}).then(function(n){return Ie=n??[],Ie}).catch(function(){Y.add(`Erreur en lisant l'api /list (project ${t})`,0)}).finally(function(){Ct=null})),Ct}};var Ar=0,je="name",Mn={view(t){return wt.isLoading()?(0,P.default)("div","Chargement\u2026"):(0,P.default)("table.table.table-striped.table-bordered.table-condensed",(0,P.default)("thead",(0,P.default)("tr",(0,P.default)("th",{onclick(){je="name"},style:"cursor: pointer;"},ct.get().name+" - listes"),(0,P.default)("th",{onclick(){je="date"},style:"cursor: pointer;"},"Derni\xE8re modification"))),(0,P.default)(_n))}},_n={view(){let t=Array.from(wt.get());return!t||t.length===0?(0,P.default)("tbody",(0,P.default)("tr[colspan=2]",(0,P.default)("em","Aucune liste n'est enregistr\xE9e sur le serveur."))):(je==="date"&&t.sort((n,s)=>n.last_update<s.last_update?1:-1),(0,P.default)("tbody",t.map(function(n){return(0,P.default)(Bn,{key:n.id,list:n})})))}},Bn={view(t){let n=t.attrs.list;return(0,P.default)("tr",n.id===Ar?{class:"info"}:{},(0,P.default)("td",(0,P.default)(P.default.route.Link,{onclick(s){A.hasChanged()&&!confirm("Charger cette liste abandonnera les modifications en cours sur la liste actuelle. Continuer ?")&&(s.preventDefault(),s.stopPropagation())},href:`/project/${n.project_id}/list/${n.id}`},n.name)),(0,P.default)("td",(0,P.default)($n,{date:n.last_update})))}},$n={format(t){return t instanceof Date?t.toISOString().substring(0,10)+" "+t.toLocaleTimeString("fr-FR").substring(0,5):""},isRecent(t){return t instanceof Date?Date.now()-t<864e5:null},parseIsoDate(t){let n=t.split(/[^\d]/);return!n||n.length<6?null:new Date(n[0],n[1]-1,n[2],n[3],n[4],n[5])},view(t){let n=this.parseIsoDate(t.attrs.date);return n===null?null:this.isRecent(n)?(0,P.default)("strong",this.format(n)):this.format(n)}},Fn={view(t){return(0,P.default)("button.btn.btn-primary.btn-sm",{type:"button",onclick:function(){document.getElementById("lists-table").setAttribute("style","display: none")}},[(0,P.default)("i.fa.fa-eye")," Cacher"])}},Un={view(t){return(0,P.default)("button.btn.btn-primary.btn-sm",{type:"button",onclick:function(){wt.load(t.attrs.projectId)}},[(0,P.default)("i.fa.fa-refresh")," Rafra\xEEchir"])}},Pr={oninit(t){ct.load(t.attrs.projectId),wt.load(t.attrs.projectId)},view(t){return Ar=t.attrs.listId,(0,P.default)("div#lists-table",(0,P.default)(Mn),(0,P.default)("div.actions",(0,P.default)(Fn),(0,P.default)(Un,{projectId:t.attrs.projectId})))}};var ft=V(K());var ke=V(K());var Hn={start:"",end:""},ot={state:Hn};var Yt=[],zt={time:"",release:{name:"",publicationTimestamp:0,timeSinceRelease:""}},W={ids:"",promise:null,xhr:[]};function Gn(t,n){return ke.default.request({method:"GET",url:"/plugin.php",params:{page:"TicketList/api",action:"ticket",id:t,projectId:n,dateStart:ot.state.start,dateEnd:ot.state.end},withCredentials:!0,config:function(s){W.xhr.push(s)}}).then(function(s){return Yt=s.tickets??[],s.message&&Y.add(s.message,5e3),Yt}).catch(function(){Y.add(`Erreur en lisant l'api /ticket (ids ${t})`,0)})}function Jn(t,n){return ke.default.request({method:"GET",url:"/plugin.php",params:{page:"TicketList/api",action:"ticket/time",id:t,projectId:n,dateStart:ot.state.start,dateEnd:ot.state.end},withCredentials:!0,config:function(s){W.xhr.push(s)}}).then(function(s){return zt=s??null,zt}).catch(function(){Y.add(`Erreur en lisant l'api /ticket/time (ids ${t})`,0)})}var at={get(){return Yt},getTimeSpent(){return zt},hasChanged(t){let n=t.join(",");return!W.ids||W.ids!==n},isLoading(){return W!==null},load(t,n){let s=t.join(",");if(s==="")return Yt=[],zt=null,Promise.resolve([]);if(W.promise!==null){if(W.ids===s)return W.promise;if(W.xhr.length>0){for(let m of W.xhr)m.abort();W.xhr=[],W.promise=null}}W.ids=s;let l=[Gn(s,n)];return n>0?l.push(Jn(s,n)):zt={},W.promise=Promise.all(l).finally(function(){W.promise=null,W.xhr=[]}),W.promise}};var nt=V(K());var U=V(K());var Or={view(t){return(0,U.default)("div.form-group",(0,U.default)("label.control-label",t.attrs.label),t.children)}},Kn={view(t){let n=A.get().ids,s=(n.match(/\n/g)||[]).length;return(0,U.default)(Or,{label:"Tickets #"},(0,U.default)("textarea.form-control",{cols:10,rows:Math.min(30,Math.max(12,1+s)),placeholder:`Pour les lignes commen\xE7ant par un num\xE9ro de ticket, tous les tickets r\xE9f\xE9renc\xE9s dans le texte sont affich\xE9s.

Le reste est vu comme un commentaire.`,oninput(){A.setText(this.value);let l=A.getTicketIds();at.hasChanged(l)&&at.load(l,A.get().projectId)}},n))}},Qn={view(t){return(0,U.default)(Or,{label:"Titre de la liste"},(0,U.default)("input.form-control",{oninput(){A.setName(this.value)},placeholder:"n\xE9cessaire pour enregistrer la liste",value:A.get().name}))}},Vn={view(t){let n=A.get(),s=!(n.id>0);return(0,U.default)("button.btn.btn-primary",{type:"button",onclick(){A.save().then(l=>{if(s){let m=l.content;U.default.route.set(`/project/${m.projectId}/list/${m.id}`)}else wt.load(l.content.projectId)})},title:"Enregistrer cette liste sur le serveur",disabled:n.name===""||!A.hasChanged()},[(0,U.default)("i.fa.fa-"+(s?"plus":"pencil"))," Publier"])}},Yn={view(t){return A.get().id===0?null:(0,U.default)("button.btn.btn-danger",{type:"button",onclick(){if(!confirm("Supprimer d\xE9finitivement cette liste du serveur ?"))return!1;A.delete().then(()=>U.default.route.set(`/project/${A.get().projectId}/list/new`))},title:"Supprimer cette liste du serveur"},[(0,U.default)("i.fa.fa-trash")," Supprimer"])}},Rr={view(t){return(0,U.default)("form.form#ticketlist-form",(0,U.default)(Kn),(0,U.default)(Qn),(0,U.default)("div.actions",(0,U.default)(Vn),(0,U.default)(Yn)))}};var Et=V(K()),gt={view(t){let n=t.attrs.title,s=t.attrs.footer??null,l={class:"widget-box block "+(t.attrs.class??"")};return t.attrs.id&&(l.id=t.attrs.id),(0,Et.default)("section",l,(0,Et.default)("div",{class:"widget-header widget-header-small"},(0,Et.default)("h2",n)),(0,Et.default)("div",{class:"widget-body widget-main"},t.children),s?(0,Et.default)("div",{class:"widget-toolbox padding-8",style:"margin-top: 2em"},s):null)}};var Wn={view(t){return[(0,nt.default)("span",A.get().name||"\u2026"," ",A.hasChanged()?(0,nt.default)("i.fa.fa-exclamation-triangle",{title:"Les modifications locales ne sont pas encore enregistr\xE9es.",style:"color: #800000"}):null),(0,nt.default)(Xn,{projectId:t.attrs.projectId,listId:t.attrs.listId}),(0,nt.default)(Zn,{projectId:t.attrs.projectId,listId:t.attrs.listId})]}},Xn={view(t){if(t.attrs.listId)return null;let n=A.getTicketIds();return n.length<2?null:(0,nt.default)(nt.default.route.Link,{class:"btn btn-default btn-sm",href:`/project/${t.attrs.projectId}/new/${n.join(",")}`,title:"Lien p\xE9renne vers cette liste (sans enregistrement sur le serveur)"},(0,nt.default)("i.fa.fa-link"))}},Zn={view(t){return t.attrs.listId?(0,nt.default)("button.btn.btn-default.btn-sm",{onclick:function(){nt.default.route.set(`/project/${t.attrs.projectId}/list/new`)},title:"Nouvelle liste",type:"button"},(0,nt.default)("i.fa.fa-eraser")):null}},Sr={view(t){return(0,nt.default)(gt,{class:"widget-color-blue2",id:"select-tickets",title:(0,nt.default)(Wn,{projectId:t.attrs.projectId,listId:t.attrs.listId})},(0,nt.default)(Rr))}};var st=V(K());var ti={view(t){let n=t.attrs.before,s=t.attrs.after,l=new Set(n);for(let c of s)l.has(c)||l.add(c);let m=[];for(let c of l)n.includes(c)?s.includes(c)?m.push((0,st.default)("span",{title:"Ticket pr\xE9sent sur le serveur et en local"},c)):m.push((0,st.default)("span.removed",{title:"Ticket du serveur absent en local"},c)):m.push((0,st.default)("span.added",{title:"Ticket local absent du serveur"},c));return(0,st.default)("div.ticket-numbers",m)}},Dr={view(){let t=pt.get();return Object.hasOwn(t,"serverList")?(0,st.default)("div#list-conflict",(0,st.default)("div","Liste enregistr\xE9e le : ",(0,st.default)("strong",t.serverList.lastUpdate)),(0,st.default)("h4","Contenu"),(0,st.default)("pre",(0,st.default)("samp",t.serverList.ids)),(0,st.default)("h4","Comparaison"),(0,st.default)(ti,{before:t.serverIds,after:t.localIds})):null}};var Q=V(K()),ei={view(t){let n=t.attrs.ticket,s=t.attrs.selectable;return(0,Q.default)("tr",{class:`status-${n.status}-bg`},(0,Q.default)("td",s instanceof Array?(0,Q.default)(ri,{id:n.id,selectable:s}):null),(0,Q.default)("td",Q.default.trust(n.link)),(0,Q.default)("td",n.statusText),(0,Q.default)("td",n.summary))}},ri={view(t){let n=t.attrs.selectable;return(0,Q.default)("input",{class:"selected-issues",type:"checkbox",name:"issueId",value:t.attrs.id,onchange(s){n.length=0;let l=s.target.closest("tbody").querySelectorAll("input.selected-issues:checked");for(let m of l){let c=parseInt(m.value,10);!isNaN(c)&&c>0&&n.push(c)}}})}},Mt={view(t){let n=t.attrs.tickets,s=t.attrs.selectable??!1;return(0,Q.default)("table",{class:"buglist table table-bordered table-condensed table-hover"},(0,Q.default)("thead",(0,Q.default)("tr",s instanceof Array?(0,Q.default)("th"):null,(0,Q.default)("th","ID"),(0,Q.default)("th","statut"),(0,Q.default)("th","r\xE9sum\xE9"))),(0,Q.default)("tbody",n.map(l=>(0,Q.default)(ei,{ticket:l,selectable:s,key:l.id}))))}};var q=V(K());var _t=!1,Le=()=>{Ce.loading=!0,at.load(A.getTicketIds(),A.get().projectId).then(()=>{Ce.loading=!1})};function zr(t){return n=>n.match(/^\d{4}-\d\d-\d\d$/)?(ot.state[t]!==n&&(ot.state[t]=n,Le()),!0):(ot.state[t]!==""&&(ot.state[t]="",Le()),!1)}var ni={view(t){let n=t.attrs.tickets;return[`Tickets list\xE9s (${n.length})`,(0,q.default)("span.actions",(0,q.default)(Ce,{num:n.length}),ct.hasManagerRights()?(0,q.default)(ii,{num:n.length}):null)]}},Ce={loading:!1,view(t){return t.attrs.num===0?null:(0,q.default)("button",{class:"btn btn-default btn-sm",title:"Relire les \xE9tats de ces tickets sur le serveur",type:"button",onclick:Le,disabled:this.loading},this.loading?(0,q.default)("i.fa.fa-spinner"):(0,q.default)("i.fa.fa-refresh"))}},ii={view(t){return t.attrs.num===0?null:(0,q.default)("button",{class:"btn btn-default btn-sm"+(_t?" active":""),title:"Activer le mode pour s\xE9lectionner des tickets et les fermer d'ensemble",type:"button",onclick:()=>{_t=!_t}},(0,q.default)("i.fa.fa-wrench"))}},si={view(t){if(!_t)return null;let n=t.attrs.selection;return(0,q.default)("a",{class:"btn btn-danger",title:"Ouvrir un formulaire pour fermer simultan\xE9ment les tickets s\xE9lectionn\xE9s",href:"/plugin.php?page=TicketList/close&ids="+n.join(","),disabled:n.length===0},"Fermer\u2026")}},Mr={oninit(t){t.state.valid=!1},view(t){return(0,q.default)("div.form-group",t.state.valid?{class:"has-success has-feedbak",style:"position:relative"}:{},[(0,q.default)("input.form-control",{placeholder:"YYYY-MM-DD",size:"11",oninput:function(){t.state.valid=t.attrs.oninput(this.value)}}),(0,q.default)("span.glyphicon.glyphicon-ok.form-control-feedback"+(t.state.valid?"":".hidden"),{"aria-hidden":"true"})])}},ai={view(){return(0,q.default)("details",{style:"margin-top: 1ex"},[(0,q.default)("summary",{style:"display: list-item"},"Filtrer par dates"),(0,q.default)("div.form-inline","De ",(0,q.default)(Mr,{oninput:zr("start")})," \xE0 ",(0,q.default)(Mr,{oninput:zr("end")}))])}},li={view(){let t=at.getTimeSpent()||0;return(0,q.default)("div",`Temps total consacr\xE9 \xE0 ces tickets : ${t.time}`,t.minutes>0?(0,q.default)(ui,{release:t.release}):null,(0,q.default)(ai))}},ui={view(t){let n=t.attrs.release;return n===null||n.name===""?null:(0,q.default)("span",[" dont ",(0,q.default)("strong",n.timeSinceRelease)," depuis la livraison ",(0,q.default)("a",{href:`/changelog_page.php?version_id=${n.id}`},n.name)])}},_r={selection:[],oninit(){this.selection=[]},view(){let t=at.get();return(0,q.default)(gt,{id:"issues-main-table",class:"tickets-block",title:(0,q.default)(ni,{tickets:t}),footer:(0,q.default)(li)},(0,q.default)(Mt,{tickets:t,selectable:_t?this.selection:null}),(0,q.default)("div.actions",{style:"text-align: right"},(0,q.default)(si,{selection:this.selection})))}};var Br=80,$r={view(t){let n=at.get();return(0,ft.default)(`div.blocks-container.ticket-count-${n.length}`,(0,ft.default)(Sr,{projectId:t.attrs.projectId,listId:t.attrs.listId}),pt.isEmpty()?null:(0,ft.default)(gt,{title:"Conflit avec la version du serveur"},(0,ft.default)(Dr)),(0,ft.default)(_r),(0,ft.default)(gt,{class:"tickets-block tickets-block-extra",title:"Non valid\xE9s"},(0,ft.default)(Mt,{tickets:n.filter(s=>s.status<=Br).sort((s,l)=>s.id-l.id)})),(0,ft.default)(gt,{class:"tickets-block tickets-block-extra",title:"Dev non fini"},(0,ft.default)(Mt,{tickets:n.filter(s=>s.status<Br).sort((s,l)=>s.id-l.id)})))}};var vt={_decode:t=>Uint8Array.from(atob(t),n=>n.charCodeAt(0)),_encode:t=>btoa(String.fromCharCode(...new Uint8Array(t))),decodeToString:t=>new TextDecoder().decode(vt._decode(t)),encodeString:t=>vt._encode(new TextEncoder().encode(t))};function Fr(t,n){A.setProjectId(t);let s=parseInt(n,10);return isNaN(s)||s<0?(A.reset(),at.load([],t)):A.load(s).then(()=>{at.load(A.getTicketIds(),t)})}var Ur={oninit(t){let n=parseInt(t.attrs.projectId,10);ct.load(n),Fr(n,t.attrs.key).then(function(){let s=qt.default.route.param("issueIds")??"";if(s.match(/^\d[\d,]+$/)){let l=s.split(",").map(m=>parseInt(m,10)).filter(m=>!isNaN(m)&&m>0).join(`
`);A.setText(l)}else s!==""&&A.setText(vt.decodeToString(s))})},onbeforeupdate(t,n){if(n.attrs.projectId!==t.attrs.projectId){let s=parseInt(t.attrs.projectId,10);ct.load(s)}n.attrs.key!==t.attrs.key&&Fr(t.attrs.projectId,t.attrs.key)},view(t){let n=parseInt(t.attrs.projectId,10)??0;(isNaN(n)||n<0)&&(n=0);let s=parseInt(t.attrs.key,10);return(isNaN(s)||s<0)&&(s=0),(0,qt.default)("div",(0,qt.default)(vr),(0,qt.default)(Pr,{projectId:n,listId:s}),(0,qt.default)($r,{projectId:n,listId:s}))}};var Bt=V(K());function ci(t,n){if(!n||n.length===0)return t;let s=new Set;for(let l of t.matchAll(/^(\d{3,5})(?: |$)/mg))s.add(l[1]);for(let l of n.split(/,/))s.has(l)||(t+=`
`+l);return t}var Hr={oninit(t){Bt.default.request({method:"GET",url:"/plugin.php",params:{page:"TicketList/api",action:"list",name:t.attrs.listName.replaceAll("+"," "),projectId:t.attrs.projectId},withCredentials:!0}).then(function(n){let s=`/project/${t.attrs.projectId}/list/${n.id}`,l=ci(n.ids,Bt.default.route.param("issueIds"));console.log(l),l?Bt.default.route.set(s,{issueIds:vt.encodeString(l)}):Bt.default.route.set(s)}).catch(function(){alert("Erreur en lisant l'api GET /list")})},view(){return null}};document.addEventListener("DOMContentLoaded",function(){ct.readJsonBlock("ticket-list-data");let t=ct.get().id,n=document.getElementById("ticketlist-container");n!==null&&Gr.default.route(n,`/project/${t}/list/new`,{"/project/:projectId/list/:key":Ur,"/project/:projectId/name/:listName":Hr})},!1);})();
